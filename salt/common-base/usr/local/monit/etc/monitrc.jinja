#CNTV_CMS is holding this file. Please DO NOT MODIFY IT!!!

#检测周期
set daemon 10

#LOG文件
set logfile /var/log/monit.log

#mmonit
set mmonit http://monit:monit@10.70.63.131:8080/collector
set eventqueue basedir /usr/local/monit/ slots 1000

#WEB
	#设置http监控页面的端口
	set httpd port 30001

	#http监控页面的IP或域名
	#use address monit.cntv.priv
	use address #~#IP#~#

	#允许本地访问
	allow 127.0.0.1
	#允许管理机访问
	allow 10.0.0.0/255.0.0.0
	allow 172.16.0.0/255.240.0.0
	allow 192.168.0.0/255.255.0.0

	#设置管理密码
	allow admin:234rew234rew234rew

#邮件报警：
	set mailserver 10.64.12.49
	with timeout 30 seconds
	set alert songrunpeng@staff.cntv.cn
	set alert hanbing@staff.cntv.cn
	set alert huyong@staff.cntv.cn
	set mail-format {
from: cntvmonitnotify@163.com
subject: #~#IP#~# $SERVICE $EVENT -monit
message: 

#~#IP#~# $SERVICE $EVENT

IP:			#~#IP#~#
Service:		$SERVICE
Description:	$DESCRIPTION
Action:		$ACTION
Date:		$DATE
Hostname:	$HOST

click for detail: http://#~#IP#~#:30001
}

#自动加载配置文件
check file monitrc path /usr/local/monit/etc/monitrc
	group system
	if changed sha1 checksum 
		then exec "/usr/local/monit/bin/monit -c /usr/local/monit/etc/monitrc reload"

#系统检查
check system #~#IP#~#
	group system
	if memory usage > 98% then alert
	if swap usage > 25% then alert
	if cpu usage (user) > 80% for 3 cycles then alert
	if cpu usage (system) > 80% for 3 cycles then alert
	if cpu usage (wait) > 50% then alert

#设置包含配置文件
include /usr/local/monit/etc/inc/*.cfg
